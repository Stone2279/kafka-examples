CREATE STREAM PRODUKT_STREAM (PRODUKT_NAME STRING, MARKE STRING, VORRAT INTEGER) WITH (
  KAFKA_TOPIC='rest.inbound.produkt',
  VALUE_FORMAT='JSON'
);

CREATE TABLE VORRAT_BY_MARKE WITH (CLEANUP_POLICY='compact', KAFKA_TOPIC='vorrat_by_marke', PARTITIONS=1, REPLICAS=1, RETENTION_MS=604800000, VALUE_FORMAT='AVRO') AS 
SELECT PRODUKT_STREAM.MARKE MARKE,
SUM(PRODUKT_STREAM.VORRAT) TOTAL_VORRAT
FROM PRODUKT_STREAM PRODUKT_STREAM
GROUP BY PRODUKT_STREAM.MARKE
EMIT CHANGES;

SELECT * FROM VORRAT_BY_MARKE;
