CREATE STREAM KUNDEN_DEBEZIUM
WITH (KAFKA_TOPIC='mypostgres.public.test_kunden',VALUE_FORMAT='AVRO',KEY_FORMAT='JSON');

CREATE STREAM kunden_restructured AS SELECT after->id, after->name, after->country, after->address FROM KUNDEN_DEBEZIUM EMIT CHANGES;

CREATE TABLE KUNDEN_BY_COUNTRY AS 
SELECT COUNTRY, COUNT(COUNTRY) AS NR_OF_KUNDEN FROM KUNDEN_RESTRUCTURED GROUP BY country EMIT CHANGES;

SELECT COUNTRY, NR_OF_KUNDEN FROM KUNDEN_BY_COUNTRY;